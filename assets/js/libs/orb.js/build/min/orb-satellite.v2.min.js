Orb.SGP4=Orb.SGP4||function(t){this.tle=t,this.orbital_elements=this.DecodeTLE(),this.sgp4=this.SetSGP4(),this.orbital_period=this.sgp4.orbital_period,this.apogee=this.sgp4.apogee,this.perigee=this.sgp4.perigee},Orb.SGP4.prototype={DecodeTLE:function(){var t=this.tle,e=t.name,o=t.first_line,a=t.second_line,i=Number(o.slice(18,20));if(i<57)r=i+2e3;else var r=i+1900;var n=1e-5*Number(o.substring(53,59)),s=Number("1e"+Number(o.substring(59,61))),c=n*s;return{name:e,line_number_1:Number(o.slice(0,0)),catalog_no_1:Number(o.slice(2,6)),security_classification:Number(o.slice(7,7)),international_identification:Number(o.slice(9,17)),epoch_year:r,epoch:Number(o.substring(20,32)),first_derivative_mean_motion:Number(o.substring(33,43)),second_derivative_mean_motion:Number(o.substring(44,52)),bstar_mantissa:n,bstar_exponent:s,bstar:c,ephemeris_type:Number(o.substring(62,63)),element_number:Number(o.substring(64,68)),check_sum_1:Number(o.substring(69,69)),line_number_2:Number(o.slice(0,0)),catalog_no_2:Number(a.slice(2,7)),inclination:Number(a.substring(8,16)),right_ascension:Number(a.substring(17,25)),eccentricity:Number(a.substring(26,33)),argument_of_perigee:Number(a.substring(34,42)),mean_anomaly:Number(a.substring(43,51)),mean_motion:Number(a.substring(52,63)),rev_number_at_epoch:Number(a.substring(64,68)),check_sum_2:Number(o.substring(68,69))}},SetSGP4:function(){var t=this.orbital_elements,e=Math.PI/180,o=541308e-9,a=t.epoch,i=t.epoch_year,r=t.bstar,n=t.inclination*e,s=t.right_ascension*e,c=1e-7*t.eccentricity,h=t.argument_of_perigee*e,m=t.mean_anomaly*e,u=2*t.mean_motion*Math.PI/1440,b=Math.pow(.0743669161/u,.66666667),d=Math.cos(n),l=d*d,_=3*l-1,g=1-c*c,p=Math.sqrt(g),M=1.5*o*_/(b*b*p*g),x=b*(1-M*(1/3+M*(1+134/81*M))),f=1.5*o*_/(x*x*p*g),y=u/(1+f),v=x/(1-f),N=1440/Number(t.mean_motion),k=0;v*(1-c)/1<220/6378.135+1&&(k=1);var w=1.01222928,P=1.88027916e-9,S=6378.135*(v*(1-c)-1),G=6378.135*(v*(1+c)-1);if(S<156)if(w=S-78,S<=98)w=20;else{P=Math.pow(1*(120-w)/6378.135,4);w=w/6378.135+1}var O=1/(v*v*g*g),q=1/(v-w),z=v*c*q,T=z*z,D=c*z,E=Math.abs(1-T),C=P*Math.pow(q,4),I=C/Math.pow(E,3.5),R=r*(I*y*(v*(1+1.5*T+D*(4+T))+.75*o*q/E*_*(8+3*T*(8+T)))),A=Math.sin(n),L=253881e-11/o*Math.pow(1,3),U=C*q*L*y*1*A/c,j=1-l,B=2*y*I*v*g*(z*(2+.5*T)+c*(.5+2*T)-2*o*q/(v*E)*(-3*_*(1-2*D+T*(1.5-.5*D))+.75*j*(2*T-D*(1+T))*Math.cos(2*h))),F=2*I*v*g*(1+2.75*(T+D)+D*T),H=l*l,J=3*o*O*y,K=J*o*O,Q=1.25*6.2098875e-7*O*O*y,V=y+.5*J*p*_+.0625*K*p*(13-78*l+137*H),W=-.5*J*(1-5*l)+.0625*K*(7-114*l+395*H)+Q*(3-36*l+49*H),X=-J*d,Y=X+(.5*K*(4-19*l)+2*Q*(3-7*l))*d,Z=r*U*Math.cos(h),$=-.66666667*C*r*1/D,tt=3.5*g*X*R,et=1.5*R,ot=.125*L*A*(3+5*d)/(1+d),at=.25*L*A,it=Math.pow(1+z*Math.cos(m),3),rt=Math.sin(m);if(1!=k)var nt=R*R,st=4*v*q*nt,ct=st*q*R/3,ht=(17*v+w)*ct,mt=.5*ct*v*q*(221*v+31*w)*R,ut=st+2*nt,bt=.25*(3*ht+R*(12*st+10*nt)),dt=.2*(3*mt+12*R*ht+6*st*st+15*nt*(2*st+nt));return{orbital_elements:t,apogee:G,perigee:S,orbital_period:N,epoch_year:i,epoch:a,xmo:m,xmdot:V,omegao:h,omgdot:W,xnodeo:s,xnodot:Y,xnodcf:tt,bstar:r,t2cof:et,omgcof:Z,isimp:k,xmcof:$,eta:z,delmo:it,c1:R,c4:B,c5:F,d2:st,d3:ht,d4:mt,sinmo:rt,t3cof:ut,t4cof:bt,t5cof:dt,aodp:v,eo:c,xnodp:y,xke:.0743669161,xlcof:ot,aycof:at,x3thm1:_,x1mth2:j,xincl:n,cosio:d,sinio:A,e6a:1e-6,ck2:o,x7thm1:7*l-1,xkmper:6378.135}},ExecSGP4:function(t){Orb.Constant.RAD;var e=this.sgp4,o=function(t,e){var o=e.epoch_year,a=e.epoch,i=o-1;return(Date.UTC(t.year,t.month-1,t.day,t.hours,t.minutes,t.seconds)-(Date.UTC(i,11,31,0,0,0)+24*a*60*60*1e3))/6e4}(t,this.orbital_elements),a=e.xmo,i=e.xmdot,r=e.omegao,n=e.omgdot,s=e.xnodeo,c=e.xnodot,h=e.xnodcf,m=e.bstar,u=e.t2cof,b=e.omgcof,d=e.isimp,l=e.xmcof,_=e.eta,g=e.delmo,p=e.c1,M=e.c4,x=e.c5,f=e.d2,y=e.d3,v=e.d4,N=e.sinmo,k=e.t3cof,w=e.t4cof,P=e.t5cof,S=e.aodp,G=e.eo,O=e.xnodp,q=e.xke,z=e.xlcof,T=e.aycof,D=e.x3thm1,E=e.x1mth2,C=e.xincl,I=e.cosio,R=e.sinio,A=e.e6a,L=e.ck2,U=e.x7thm1,j=e.xkmper,B=(e.epoch_year,e.epoch,a+i*o),F=r+n*o,H=F,J=B,K=o*o,Q=s+c*o+h*K,V=1-p*o,W=m*M*o,X=u*K;if(1!=d)var J=B+(rt=b*o+l*(Math.pow(1+_*Math.cos(B),3)-g)),H=F-rt,Y=K*o,Z=o*Y,V=V-f*K-y*Y-v*Z,W=W+m*x*(Math.sin(J)-N),X=X+k*Y+Z*(w+o*P);for(var $=S*V*V,tt=G-W,et=J+H+Q+O*X,ot=Math.sqrt(1-tt*tt),at=q/Math.pow($,1.5),it=tt*Math.cos(H),rt=1/($*ot*ot),nt=rt*T,st=et+rt*z*it,ct=tt*Math.sin(H)+nt,ht=(st-Q)%(2*Math.PI),mt=ht,ut=1;ut<=10;ut++){var bt=Math.sin(mt),dt=Math.cos(mt),lt=ct*dt,_t=it*dt,gt=ct*bt,pt=(ht-lt+(wt=it*bt)-mt)/(1-_t-gt)+mt;if(Math.abs(pt-mt)<=A)break;mt=pt}var Mt=wt-lt,xt=$*(rt=1-(it*it+ct*ct)),ft=$*(1-(_t+gt)),yt=1/ft,vt=q*Math.sqrt($)*Mt*yt,Nt=q*Math.sqrt(xt)*yt,mt=$*yt,kt=Math.sqrt(rt),wt=1/(1+kt),Pt=mt*(dt-it+ct*Mt*wt),St=mt*(bt-ct-it*Mt*wt),Gt=Math.atan2(St,Pt);Gt<0&&(Gt+=2*Math.PI);var Ot=2*St*Pt,qt=2*Pt*Pt-1,zt=ft*(1-1.5*(mt=(yt=L*(rt=1/xt))*rt)*kt*D)+.5*yt*E*qt,Tt=Gt-.25*mt*U*Ot,Dt=Q+1.5*mt*I*Ot,Et=C+1.5*mt*I*R*qt,Ct=vt-at*yt*E*Ot,It=Nt+at*yt*(E*qt+1.5*D),Rt=Math.sin(Tt),At=Math.cos(Tt),Lt=Math.sin(Et),Ut=Math.cos(Et),jt=Math.sin(Dt),Bt=Math.cos(Dt),Ft=-jt*Ut,Ht=Bt*Ut,Jt=Ft*Rt+Bt*At,Kt=Ht*Rt+jt*At,Qt=Lt*Rt;return{x:zt*Jt*j,y:zt*Kt*j,z:zt*Qt*j,xdot:(Ct*Jt+It*(Ft*At-Bt*Rt))*j/60,ydot:(Ct*Kt+It*(Ht*At-jt*Rt))*j/60,zdot:(Ct*Qt+It*(Lt*At))*j/60}},RectangularToGeographic:function(t,e){var t=t,o=e.x,a=e.y,i=e.z,r=e.xdot,n=e.ydot,s=e.zdot,c=Orb.Constant.RAD,h=15*t.gmst(),m=.00335277945,u=6378.135,b=Math.sqrt(o*o+a*a),d=Math.atan2(a,o)/c-h;d>360&&(d%=360),d<0&&(d=d%360+360),d>180&&(d-=360);var l=Math.atan2(i,b),_=m*(2-m),g=0;do{g=l;var p=Math.sin(g),M=1/Math.sqrt(1-_*p*p);l=Math.atan2(i+u*M*_*Math.sin(g),b)}while(Math.abs(l-g)>1e-4);return{longitude:d,latitude:l/c,altitude:b/Math.cos(l)-u*M,velocity:Math.sqrt(r*r+n*n+s*s)}},xyz:function(t){var e=new Orb.Time(t),o=this.ExecSGP4(e);return{x:o.x,y:o.y,z:o.z,xdot:o.xdot,ydot:o.ydot,zdot:o.zdot,date:t,coordinate_keywords:"equational rectangular",unit_keywords:"km"}},latlng:function(t){var e=new Orb.Time(t),o=this.ExecSGP4(e),a=this.RectangularToGeographic(e,o);return{latitude:a.latitude,longitude:a.longitude,altitude:a.altitude,velocity:a.velocity,date:t,coordinate_keywords:"geographic spherical",unit_keywords:"degree km"}}},Orb.Satellite=Orb.Satellite||Orb.SGP4;